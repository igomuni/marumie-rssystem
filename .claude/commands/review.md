---
description: 現在の変更に対して設計レビューを行う
---

## 現在の状況

- 現在のブランチ: !`git branch --show-current`
- 変更ファイル: !`git diff --name-only HEAD~1 2>/dev/null || git diff --name-only --cached 2>/dev/null || git diff --name-only`

## タスク

以下の手順で現在のブランチの変更内容に対して設計レビューを行ってください：

1. **変更内容の把握**: `git diff` で変更されたファイルの差分を取得し、変更内容を把握する。必要に応じて関連ファイルも読み込む。

2. **レイヤー設計のチェック**: 変更対象に応じて以下を確認する：
   - `app/lib/sankey-generator.ts` の変更: HTTPリクエスト・Reactコードが含まれていないか（Pure logic only）
   - `app/api/*/route.ts` の変更: ビジネスロジックが `app/lib/` に委譲されているか
   - `client/components/` の変更: 直接APIコールが含まれていないか（hooks経由であるか）
   - `app/sankey/page.tsx` の変更: 状態管理・API呼び出し・レイアウトのみか（ロジックが肥大化していないか）
   - `scripts/` の変更: UIロジックが含まれていないか

3. **レビュー実施**: 以下の観点でレビューを行う：
   - **アーキテクチャ**: レイヤー設計との整合性
   - **データ単位**: 金額が1円単位で正しく扱われているか（**CRITICAL**: 千円単位と混同しないこと）
   - **型安全性**: TypeScriptの型が適切に定義されているか、`any`の使用がないか
   - **命名**: 変数名・関数名・ファイル名が適切か（日本語コメントは許容）
   - **パフォーマンス**: Sankeyの不必要な再レンダリングが発生していないか、APIキャッシュが正しく機能しているか

4. **結果報告**: 以下の形式でレビュー結果を報告する。重大な問題がない場合は「✅ 設計上の問題は見つかりませんでした」と報告する。

```
## レビュー結果

### ✅ 良い点
- ...

### ⚠️ 改善提案
- **[ファイル名:行番号]** 問題の説明
  - 提案: ...

### ❌ 要修正
- **[ファイル名:行番号]** 問題の説明
  - 理由: ...
  - 修正案: ...
```
