# 歳入列実装計画 - 統合版

**作成日**: 2026年2月3日 14:00
**目的**: RSシステムとMOFデータの予算額ズレを踏まえた歳入列実装の総合計画
**前提**: 調査ドキュメント4件の分析結果を統合

---

## エグゼクティブサマリー

### 調査結果の統合

RSシステム(151.1兆円)とMOF予算総額(556.3兆円)の関係が明確になりました：

```
MOF予算総額 556.3兆円
├─ RS対象範囲: 151.1兆円（27.2%）← サンキー図の対象
└─ RS対象外: 405.2兆円（72.8%）← 国債・地方財源等の制度的支出
```

### 実装方針の決定

**選択肢A「RSベース推定財源」を採用**

理由：
1. 現在のサンキー構造（事業→支出先）を維持できる
2. 財源内訳は「参考情報」として位置づけ
3. MOF-RS間のズレを明示的に注記することで誤解を防止

### 実装スコープ

| Phase | 内容 | 工数見積 | 優先度 |
|-------|------|---------|--------|
| **Phase 1** | MOFデータパース＋構造化 | 2-3時間 | **必須** |
| **Phase 2** | 財源按分ロジック実装 | 5-8時間 | **必須** |
| **Phase 3** | サンキー図への歳入列追加 | 8-12時間 | **必須** |
| **Phase 4** | ツールチップへの財源情報表示 | 5-8時間 | 推奨 |
| **Phase 5** | 財源別ビュー（別画面） | 20-30時間 | 将来 |

**MVP（最小実装）**: Phase 1-3（15-23時間）
**推奨スコープ**: Phase 1-4（27-39時間）

---

## 1. 予算額のズレの理解

### 1.1 MOFとRSの対応関係

#### 一般会計

```
【MOF一般会計】114.4兆円
├─ RS対象: 72.56兆円（63.4%）← 事業として計上された予算
└─ RS対象外: 41.84兆円（36.6%）
   ├─ 国債費: 25.25兆円（既存国債の返済・利払い）
   ├─ 地方交付税: 16.40兆円（地方自治体への財源移転）
   └─ 予備費等: 0.19兆円
```

#### 特別会計

```
【MOF特別会計】441.9兆円
├─ RS対象: 78.56兆円（17.8%）← 事業として計上された予算
│  ├─ 年金事業: 68.52兆円
│  ├─ 労働保険: 4.35兆円
│  └─ その他: 5.69兆円
│
└─ RS対象外: 363.35兆円（82.2%）
   ├─ 国債整理基金: 239.47兆円（借換債等）
   ├─ 地方交付税配付金: 49.54兆円
   ├─ 財政投融資: 24.94兆円
   ├─ 年金給付等: 31.0兆円（給付金支払い）
   └─ その他: 18.40兆円
```

#### 合計

| 区分 | MOF総額 | RS対象 | RS対象外 | RS対象率 |
|------|---------|--------|----------|----------|
| 一般会計 | 114.4兆円 | 72.56兆円 | 41.84兆円 | **63.4%** |
| 特別会計 | 441.9兆円 | 78.56兆円 | 363.35兆円 | **17.8%** |
| **合計** | **556.3兆円** | **151.1兆円** | **405.2兆円** | **27.2%** |

### 1.2 RS対象外の内訳

RS対象外405.2兆円の主要カテゴリ：

| カテゴリ | 金額 | 構成比 | 理由 |
|---------|------|--------|------|
| 国債関連 | 264.72兆円 | 65.3% | 制度的義務（事業ではない） |
| 地方財源 | 65.94兆円 | 16.3% | 財源移転（事業ではない） |
| 年金給付等 | 31.0兆円 | 7.6% | 給付型支出（制度運営費のみRS対象） |
| 財政投融資 | 24.94兆円 | 6.2% | 金融活動（事業ではない） |
| その他 | 18.59兆円 | 4.6% | - |

**重要**: RSシステムは「事業レビュー」対象のみをカバーするため、制度的支出・給付型支出・金融的支出は含まれない。

---

## 2. 財源データの構成

### 2.1 一般会計の財源（MOFデータ）

#### 歳入構成（114.4兆円）

| 財源 | 金額 | 構成比 | 説明 |
|------|------|--------|------|
| **租税** | **68.46兆円** | **59.9%** | 所得税・法人税・消費税等 |
| **公債金** | **35.62兆円** | **31.1%** | 新規国債発行（財政赤字） |
| その他収入 | 9.32兆円 | 8.1% | 諸収入・納付金・印紙収入等 |
| **合計** | **114.38兆円** | **100%** | - |

#### 租税収入の内訳（68.46兆円）

| 順位 | 税目 | 金額 | 構成比 |
|------|------|------|--------|
| 1 | 消費税 | 23.38兆円 | 34.2% |
| 2 | 所得税 | 21.05兆円 | 30.7% |
| 3 | 法人税 | 14.60兆円 | 21.3% |
| 4 | 相続税 | 2.78兆円 | 4.1% |
| 5 | 揮発油税 | 2.00兆円 | 2.9% |
| - | その他 | 4.65兆円 | 6.8% |

### 2.2 特別会計の財源（MOFデータ）

#### 歳入構成（主要項目）

| 項目 | 金額 | 説明 |
|------|------|------|
| 公債金 | 165.12兆円 | 借換債が大部分（RS対象外） |
| 他会計より受入 | 81.32兆円 | 特別会計間繰入（重複計上） |
| **保険料収入** | **50.17兆円** | 年金・医療・雇用保険料 |
| 一般会計より受入 | 32.51兆円 | 税金からの繰入 |
| その他 | 112.78兆円 | 借入金・拠出金等 |

#### 年金特別会計の財源構成（52.2兆円）

| 財源 | 予算額 | 決算額 | 構成比（決算） |
|------|--------|--------|--------------|
| **保険料** | 36.46兆円 | **37.75兆円** | **73%** |
| **税金（一般会計繰入）** | 15.74兆円 | **13.85兆円** | **27%** |
| **合計** | 52.20兆円 | 51.60兆円 | 100% |

**重要発見**（決算データ）:
- 保険料収入が予算を+1.29兆円上回った（雇用情勢改善・賃金上昇）
- 税金繰入が予算を-1.89兆円下回った（保険料増加により補填減）
- 保険料依存度が70%→73%に上昇（制度の持続可能性向上）

### 2.3 公債金と国債費の違い（重要）

#### よくある誤解の解消

| 誤解 | 正しい理解 |
|------|----------|
| ❌ 「毎年180兆円も借金している」 | ✅ 新規国債は約35兆円、残り145兆円は既存国債の借り換え（借換債） |
| ❌ 「公債金35兆円 = 国債費25兆円」 | ✅ 公債金は新規発行、国債費は既存返済。差額10兆円が国債残高純増 |

#### 国債の流れ

```
【歳入】公債金（新規国債発行）: 35.62兆円
  ↓
一般会計財源として使用
  ↓ 約15兆円
【歳出】国債費（既存国債返済）: 25.25兆円
  ↓
差額 10.37兆円 = 国債残高の純増
```

---

## 3. 実装アプローチ：選択肢Aの詳細設計

### 3.1 なぜ選択肢Aを採用するか

#### 比較表

| 項目 | 選択肢A（RSベース） | 選択肢B（MOFベース） | 選択肢C（ハイブリッド） |
|------|-------------------|---------------------|-------------------|
| 財源精度 | 推定値（按分） | 正確 | 両方表示 |
| 事業接続 | ✅ 可能 | ❌ 不可 | 複雑 |
| 実装難易度 | 中 | 低 | 高 |
| ユーザー体験 | 一貫性あり | 分断される | 複雑 |
| **採用判断** | **✅ 採用** | ❌ 却下 | △ 将来検討 |

#### 選択肢Aの利点

1. **既存サンキー構造の維持**
   - 予算総計 → 府省庁 → 事業 → 支出先の流れを保持
   - ユーザーの学習コストゼロ

2. **財源を左端に追加するだけ**
   - 5列構成 → 6列構成
   - Column 1: 財源（新規追加）
   - Column 2: 予算総計（既存）
   - Column 3-6: 既存のまま

3. **推定値であることを明示**
   - ツールチップに注記
   - ドキュメントで説明
   - 誤解を防止

### 3.2 財源按分ロジック

#### 一般会計の按分

RS一般会計(72.56兆円)に対して、MOF一般会計の財源比率を適用：

```typescript
const generalAccountFunding = {
  taxRevenue: 72.56 * 0.599,      // 43.46兆円（59.9%）
  publicBonds: 72.56 * 0.311,     // 22.57兆円（31.1%）
  other: 72.56 * 0.090,           // 6.53兆円（9.0%）
  total: 72.56,
};
```

#### 特別会計の按分

RS特別会計(78.56兆円)を会計種別ごとに分割して按分：

```typescript
// 年金特別会計（68.52兆円）
const pensionFunding = {
  insurancePremiums: 68.52 * 0.73,  // 50.02兆円（73%、決算ベース）
  transferFromGeneral: 68.52 * 0.27, // 18.50兆円（27%、決算ベース）
  total: 68.52,
};

// 労働保険特別会計（4.35兆円）
const laborInsuranceFunding = {
  insurancePremiums: 4.35 * 0.97,   // 4.22兆円（97%）
  transferFromGeneral: 4.35 * 0.03, // 0.13兆円（3%）
  total: 4.35,
};

// その他特別会計（5.69兆円）
const otherSpecialFunding = {
  // 会計ごとに個別設定（データがあれば）
  // または一般会計と同じ比率を適用
};
```

#### 合計財源（151.1兆円）

| 財源 | 金額 | 構成比 | 算出根拠 |
|------|------|--------|---------|
| **租税** | **43.46兆円** | **28.8%** | 一般会計分のみ |
| **公債金** | **22.57兆円** | **14.9%** | 一般会計分のみ |
| **社会保険料** | **54.24兆円** | **35.9%** | 年金50.02兆円 + 労働4.22兆円 |
| **一般会計繰入（税金）** | **18.63兆円** | **12.3%** | 年金18.50兆円 + 労働0.13兆円 |
| **その他** | **12.22兆円** | **8.1%** | 一般会計その他6.53兆円 + 特別その他5.69兆円 |
| **合計** | **151.12兆円** | **100%** | - |

### 3.3 注記事項（必須）

すべての財源表示に以下の注記を添える：

```
※ 財源内訳は財務省データに基づく推定値です

【重要】本サンキー図の予算総額151.1兆円は、
政府予算全体（556.3兆円）のうち「事業レビュー対象」のみを含みます。

以下は含まれません：
- 国債費・国債整理基金（264.7兆円）: 既存国債の返済
- 地方交付税・配付金（65.9兆円）: 地方自治体への財源移転
- 年金・保険給付金（31.0兆円）: 受給者への給付
- 財政投融資（24.9兆円）: 融資・投資活動
- その他（18.6兆円）

詳細は「予算の範囲について」をご参照ください。
```

---

## 4. Phase別実装計画

### Phase 1: MOFデータパース＋構造化（2-3時間）

#### 実装内容

1. **CSVパーサー作成**
   ```typescript
   // scripts/parse-mof-data.ts

   interface MOFRevenueData {
     fiscalYear: number;
     accountType: '一般会計' | '特別会計';

     // 一般会計財源
     taxRevenue?: number;        // 租税
     publicBonds?: number;       // 公債金
     otherRevenue?: number;      // その他収入

     // 特別会計財源
     specialAccountName?: string;
     insurancePremiums?: number; // 保険料
     transferFromGeneral?: number; // 一般会計繰入
     transferFromOther?: number; // 他会計繰入
     borrowings?: number;        // 借入金
     otherSpecialRevenue?: number;

     total: number;
   }
   ```

2. **データファイル読み込み**
   - `data/download/mof_2023/DL202311001a.csv` (一般会計歳入)
   - `data/download/mof_2023/DL202312001a.csv` (特別会計歳入)

3. **財源集計**
   ```typescript
   function aggregateFundingSources(csvData: CSVRow[]): FundingSourceSummary {
     // 一般会計: 款名でグループ化（租税、公債金、その他）
     // 特別会計: 会計名・項名でグループ化（保険料、繰入、その他）
   }
   ```

4. **JSONファイル出力**
   ```
   public/data/mof-funding-sources-2023.json
   {
     "fiscalYear": 2023,
     "generalAccount": {
       "taxRevenue": 68.46,
       "publicBonds": 35.62,
       "other": 10.30,
       "total": 114.38
     },
     "specialAccounts": {
       "pension": {
         "insurancePremiums": 37.75,
         "transferFromGeneral": 13.85,
         "total": 51.60
       },
       "laborInsurance": { ... },
       ...
     }
   }
   ```

#### 検証項目

- [ ] 一般会計合計 = 114.38兆円
- [ ] 租税 = 68.46兆円、公債金 = 35.62兆円
- [ ] 特別会計の年金保険料 = 37.75兆円（決算ベース）
- [ ] JSON構造が型定義と一致

---

### Phase 2: 財源按分ロジック実装（5-8時間）

#### 実装内容

1. **型定義追加**
   ```typescript
   // types/funding.ts

   export interface FundingSourceBreakdown {
     // 一般会計由来
     taxRevenue: number;           // 租税
     publicBonds: number;          // 公債金
     otherGeneralRevenue: number;  // その他一般会計収入

     // 特別会計由来
     insurancePremiums: number;    // 社会保険料
     transferFromGeneral: number;  // 一般会計繰入（税金）
     otherSpecialRevenue: number;  // その他特別会計収入

     total: number;
   }

   export interface ProjectWithFunding extends BudgetRecord {
     fundingSources: FundingSourceBreakdown;
   }
   ```

2. **按分計算ロジック**
   ```typescript
   // app/lib/funding-allocator.ts

   export function allocateFundingToProject(
     project: BudgetRecord,
     mofData: MOFFundingData
   ): FundingSourceBreakdown {
     const { accountType, totalBudget, specialAccount } = project;

     if (accountType === '一般会計') {
       return allocateGeneralAccountFunding(totalBudget, mofData);
     } else {
       return allocateSpecialAccountFunding(
         totalBudget,
         specialAccount,
         mofData
       );
     }
   }

   function allocateGeneralAccountFunding(
     budget: number,
     mofData: MOFFundingData
   ): FundingSourceBreakdown {
     const { generalAccount } = mofData;
     const ratios = {
       tax: generalAccount.taxRevenue / generalAccount.total,
       bonds: generalAccount.publicBonds / generalAccount.total,
       other: generalAccount.other / generalAccount.total,
     };

     return {
       taxRevenue: budget * ratios.tax,
       publicBonds: budget * ratios.bonds,
       otherGeneralRevenue: budget * ratios.other,
       insurancePremiums: 0,
       transferFromGeneral: 0,
       otherSpecialRevenue: 0,
       total: budget,
     };
   }

   function allocateSpecialAccountFunding(
     budget: number,
     specialAccount: string,
     mofData: MOFFundingData
   ): FundingSourceBreakdown {
     // 特別会計名に応じて按分比率を変更
     const accountData = mofData.specialAccounts[specialAccount];

     if (specialAccount === '年金特別会計') {
       // 決算ベースの比率を使用（保険料73%、税金27%）
       return {
         taxRevenue: 0,
         publicBonds: 0,
         otherGeneralRevenue: 0,
         insurancePremiums: budget * 0.73,
         transferFromGeneral: budget * 0.27,
         otherSpecialRevenue: 0,
         total: budget,
       };
     } else if (specialAccount === '労働保険特別会計') {
       return { /* 保険料97%、税金3% */ };
     } else {
       // デフォルト按分（要調整）
       return { /* ... */ };
     }
   }
   ```

3. **rs2024-structured.jsonへの統合**
   ```typescript
   // scripts/generate-structured-json-with-funding.ts

   import { allocateFundingToProject } from '../app/lib/funding-allocator';

   const mofData = loadMOFFundingData('public/data/mof-funding-sources-2023.json');

   const budgetRecordsWithFunding: ProjectWithFunding[] = budgetRecords.map(
     (record) => ({
       ...record,
       fundingSources: allocateFundingToProject(record, mofData),
     })
   );
   ```

#### 検証項目

- [ ] 全プロジェクトの財源合計 = 151.1兆円
- [ ] 租税合計 ≈ 43.46兆円
- [ ] 社会保険料合計 ≈ 54.24兆円
- [ ] 公債金合計 ≈ 22.57兆円
- [ ] 各プロジェクトの財源合計 = プロジェクト予算額

---

### Phase 3: サンキー図への歳入列追加（8-12時間）

#### 実装内容

1. **型定義拡張**
   ```typescript
   // types/preset.ts

   export type SankeyNodeType =
     | 'funding-source'     // 新規: 財源ノード
     | 'total-budget'
     | 'ministry-budget'
     | 'project-budget'
     | 'project-spending'
     | 'recipient'
     | 'other';

   export interface FundingSourceNodeDetails {
     sourceType: 'tax' | 'bonds' | 'insurance' | 'transfer' | 'other';
     description: string;
     relatedMinistries: string[];  // この財源を使う府省庁
     relatedProjects: number;      // この財源を使う事業数
   }
   ```

2. **サンキー生成ロジック修正**
   ```typescript
   // app/lib/sankey-generator.ts

   function generateGlobalSankey(
     data: RS2024StructuredData,
     options: GenerateOptions
   ): RS2024PresetData {
     const nodes: SankeyNode[] = [];
     const links: SankeyLink[] = [];

     // Step 1: 財源ノード作成（新規）
     const fundingNodes = createFundingSourceNodes(data);
     nodes.push(...fundingNodes);

     // Step 2: 予算総計ノード（既存）
     const totalBudgetNode = createTotalBudgetNode(data);
     nodes.push(totalBudgetNode);

     // Step 3: 財源 → 予算総計のリンク（新規）
     const fundingToTotalLinks = createFundingToTotalLinks(fundingNodes, totalBudgetNode);
     links.push(...fundingToTotalLinks);

     // Step 4-7: 既存のロジック（府省庁以降）
     // ...
   }

   function createFundingSourceNodes(
     data: RS2024StructuredData
   ): SankeyNode[] {
     // 全プロジェクトの財源を集計
     const aggregated = aggregateFundingSources(data.budgets);

     return [
       {
         id: 'funding-tax',
         name: '租税',
         type: 'funding-source',
         value: aggregated.taxRevenue,
         details: {
           sourceType: 'tax',
           description: '所得税・法人税・消費税等',
           relatedMinistries: [...],
           relatedProjects: countProjectsUsingTax(data.budgets),
         },
       },
       {
         id: 'funding-bonds',
         name: '公債金（国債）',
         type: 'funding-source',
         value: aggregated.publicBonds,
         details: {
           sourceType: 'bonds',
           description: '新規国債発行による収入',
           relatedMinistries: [...],
           relatedProjects: countProjectsUsingBonds(data.budgets),
         },
       },
       {
         id: 'funding-insurance',
         name: '社会保険料',
         type: 'funding-source',
         value: aggregated.insurancePremiums,
         details: {
           sourceType: 'insurance',
           description: '年金・医療・雇用保険料',
           relatedMinistries: ['厚生労働省'],
           relatedProjects: countProjectsUsingInsurance(data.budgets),
         },
       },
       {
         id: 'funding-transfer',
         name: '一般会計繰入（税金）',
         type: 'funding-source',
         value: aggregated.transferFromGeneral,
         details: {
           sourceType: 'transfer',
           description: '一般会計から特別会計への繰入',
           relatedMinistries: ['厚生労働省', ...],
           relatedProjects: countProjectsUsingTransfer(data.budgets),
         },
       },
       {
         id: 'funding-other',
         name: 'その他収入',
         type: 'funding-source',
         value: aggregated.otherRevenue,
         details: {
           sourceType: 'other',
           description: '諸収入・納付金・印紙収入等',
           relatedMinistries: [...],
           relatedProjects: countProjectsUsingOther(data.budgets),
         },
       },
     ];
   }

   function createFundingToTotalLinks(
     fundingNodes: SankeyNode[],
     totalBudgetNode: SankeyNode
   ): SankeyLink[] {
     return fundingNodes.map((fundingNode) => ({
       source: fundingNode.id,
       target: totalBudgetNode.id,
       value: fundingNode.value,
     }));
   }
   ```

3. **UI調整**
   ```typescript
   // app/sankey/page.tsx

   <ResponsiveSankey
     data={data.sankey}
     margin={{
       top: 40,
       right: 250,  // 右側マージン拡大（財源ラベル用）
       bottom: 40,
       left: 250,   // 左側マージン拡大（財源ノード用）
     }}
     // 既存設定...
   />
   ```

4. **配色設定**
   ```typescript
   const getFundingNodeColor = (node: SankeyNode): string => {
     if (node.type === 'funding-source') {
       const sourceType = (node.details as FundingSourceNodeDetails)?.sourceType;
       switch (sourceType) {
         case 'tax':
           return '#10b981';      // 緑（持続可能な財源）
         case 'bonds':
           return '#ef4444';      // 赤（将来世代の負担）
         case 'insurance':
           return '#3b82f6';      // 青（社会保険料）
         case 'transfer':
           return '#f59e0b';      // オレンジ（税金由来）
         case 'other':
           return '#6b7280';      // グレー（その他）
         default:
           return '#9ca3af';
       }
     }
     // 既存ノードの配色...
   };
   ```

#### レイアウトイメージ

```
Column 1          Column 2        Column 3         Column 4           Column 5          Column 6
【財源】          【予算総計】    【府省庁】       【事業（予算）】   【事業（支出）】  【支出先】

租税                                厚生労働省       年金事業           年金事業          支出先A
43.5兆円                            92.8兆円         68兆円             68兆円            XX億円
  ├───────────┐
  │                 予算総計                          プロジェクトB      プロジェクトB     支出先B
公債金              151.1兆円       経済産業省        XX億円             XX億円            XX億円
22.6兆円              │             12.3兆円
  ├──────────┤
  │                   │
社会保険料            │             国土交通省       道路事業           道路事業          支出先C
54.2兆円              │             11.1兆円         XX億円             XX億円            XX億円
  └───────────┘

一般会計繰入
18.6兆円

その他
12.2兆円
```

#### 検証項目

- [ ] 6列構成で正しく表示される
- [ ] 財源ノードの合計 = 151.1兆円
- [ ] 財源 → 予算総計のリンクが正しく描画される
- [ ] 既存の府省庁以降の流れが維持される
- [ ] モバイルでも表示崩れなし

---

### Phase 4: ツールチップへの財源情報表示（5-8時間）

#### 実装内容

1. **府省庁ノードのツールチップ拡張**
   ```tsx
   // app/sankey/page.tsx

   const renderMinistryTooltip = (node: SankeyNode) => {
     const details = node.details as MinistryBudgetNodeDetails;
     const funding = calculateMinistryFunding(node, data);

     return (
       <div className="tooltip">
         <h3>{node.name}</h3>
         <p>予算: {formatBudget(node.value)}</p>
         <hr />
         <h4>財源内訳（推定）</h4>

         {/* 一般会計部分 */}
         {funding.generalAccount > 0 && (
           <div>
             <p className="font-semibold">一般会計: {formatBudget(funding.generalAccount)}</p>
             <ul className="ml-4 text-sm">
               <li>租税: {formatBudget(funding.generalTax)} ({formatPercent(funding.generalTax / funding.generalAccount)})</li>
               <li>公債金: {formatBudget(funding.generalBonds)} ({formatPercent(funding.generalBonds / funding.generalAccount)})</li>
               <li>その他: {formatBudget(funding.generalOther)} ({formatPercent(funding.generalOther / funding.generalAccount)})</li>
             </ul>
           </div>
         )}

         {/* 特別会計部分 */}
         {funding.specialAccount > 0 && (
           <div className="mt-2">
             <p className="font-semibold">特別会計: {formatBudget(funding.specialAccount)}</p>
             <ul className="ml-4 text-sm">
               <li>社会保険料: {formatBudget(funding.insurance)} ({formatPercent(funding.insurance / funding.specialAccount)})</li>
               <li>一般会計繰入（税金）: {formatBudget(funding.transfer)} ({formatPercent(funding.transfer / funding.specialAccount)})</li>
               <li>その他: {formatBudget(funding.specialOther)} ({formatPercent(funding.specialOther / funding.specialAccount)})</li>
             </ul>
           </div>
         )}

         <p className="text-xs text-gray-500 mt-2">
           ※ 財源内訳は財務省データに基づく推定値です
         </p>
       </div>
     );
   };
   ```

2. **財源ノードのツールチップ**
   ```tsx
   const renderFundingTooltip = (node: SankeyNode) => {
     const details = node.details as FundingSourceNodeDetails;

     return (
       <div className="tooltip">
         <h3>{node.name}</h3>
         <p className="text-lg font-bold">{formatBudget(node.value)}</p>
         <p className="text-sm text-gray-600">{details.description}</p>
         <hr />
         <p>関連する府省庁: {details.relatedMinistries.length}府省庁</p>
         <p>関連する事業: {details.relatedProjects}事業</p>

         {/* 税目別内訳（租税の場合） */}
         {details.sourceType === 'tax' && (
           <div className="mt-2">
             <h4 className="font-semibold">税目別内訳（全体）</h4>
             <ul className="text-sm">
               <li>消費税: 23.4兆円（34.2%）</li>
               <li>所得税: 21.1兆円（30.7%）</li>
               <li>法人税: 14.6兆円（21.3%）</li>
               <li>その他: 9.4兆円（13.8%）</li>
             </ul>
           </div>
         )}

         {/* 保険料内訳（社会保険料の場合） */}
         {details.sourceType === 'insurance' && (
           <div className="mt-2">
             <h4 className="font-semibold">保険料内訳</h4>
             <ul className="text-sm">
               <li>年金保険料: 約50兆円（92%）</li>
               <li>労働保険料: 約4兆円（8%）</li>
             </ul>
           </div>
         )}

         {/* 注記 */}
         {details.sourceType === 'bonds' && (
           <p className="text-xs text-red-600 mt-2">
             ⚠️ 公債金は将来世代の負担となります
           </p>
         )}
       </div>
     );
   };
   ```

3. **ヘルプダイアログの追加**
   ```tsx
   // components/FundingExplanationDialog.tsx

   export function FundingExplanationDialog() {
     return (
       <Dialog>
         <DialogContent>
           <DialogHeader>
             <DialogTitle>財源について</DialogTitle>
           </DialogHeader>

           <div className="space-y-4">
             <section>
               <h3 className="font-semibold">財源の種類</h3>
               <ul>
                 <li><span className="text-green-600">■</span> 租税: 所得税・法人税・消費税等</li>
                 <li><span className="text-red-600">■</span> 公債金: 新規国債発行（借金）</li>
                 <li><span className="text-blue-600">■</span> 社会保険料: 年金・医療・雇用保険料</li>
                 <li><span className="text-orange-600">■</span> 一般会計繰入: 税金から特別会計への補填</li>
                 <li><span className="text-gray-600">■</span> その他: 諸収入・納付金等</li>
               </ul>
             </section>

             <section>
               <h3 className="font-semibold">重要な注意事項</h3>
               <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                 <p className="text-sm">
                   本サンキー図の財源内訳は、財務省の歳入データをもとに<strong>按分計算した推定値</strong>です。
                   実際の事業ごとの財源は公開されていないため、会計種別（一般会計・特別会計）に基づいて按分しています。
                 </p>
               </div>
             </section>

             <section>
               <h3 className="font-semibold">予算の範囲について</h3>
               <div className="bg-blue-50 border-l-4 border-blue-400 p-4">
                 <p className="text-sm">
                   本サンキー図の予算総額<strong>151.1兆円</strong>は、
                   政府予算全体（556.3兆円）のうち「事業レビュー対象」のみを含みます。
                 </p>
                 <p className="text-sm mt-2">以下は含まれません（405.2兆円）：</p>
                 <ul className="text-sm ml-4">
                   <li>国債費・国債整理基金（264.7兆円）: 既存国債の返済</li>
                   <li>地方交付税・配付金（65.9兆円）: 地方自治体への財源移転</li>
                   <li>年金・保険給付金（31.0兆円）: 受給者への給付</li>
                   <li>財政投融資（24.9兆円）: 融資・投資活動</li>
                 </ul>
               </div>
             </section>

             <section>
               <h3 className="font-semibold">よくある誤解</h3>
               <table className="text-sm">
                 <tr>
                   <td className="pr-4">❌ 誤解</td>
                   <td>「年金は税金の無駄遣い」</td>
                 </tr>
                 <tr>
                   <td className="pr-4">✅ 正しい理解</td>
                   <td>年金の約73%は保険料で賄われており、税金は約27%のみ</td>
                 </tr>
                 <tr className="h-2"></tr>
                 <tr>
                   <td className="pr-4">❌ 誤解</td>
                   <td>「厚労省が92兆円も使っている」</td>
                 </tr>
                 <tr>
                   <td className="pr-4">✅ 正しい理解</td>
                   <td>厚労省予算の約55兆円は社会保険料（国民・企業が支払った保険料）</td>
                 </tr>
               </table>
             </section>
           </div>
         </DialogContent>
       </Dialog>
     );
   }
   ```

#### 検証項目

- [ ] 府省庁ノードのツールチップに財源内訳が表示される
- [ ] 財源ノードのツールチップに詳細情報が表示される
- [ ] 注記が明確に表示される
- [ ] ヘルプダイアログが機能する
- [ ] 金額の合計が一致する

---

### Phase 5: 財源別ビュー（別画面）（20-30時間）

#### 実装概要（将来実装）

1. **新しいビューモード追加**
   ```typescript
   type ViewMode =
     | 'global'
     | 'ministry'
     | 'project'
     | 'spending'
     | 'funding'  // 新規
   ```

2. **財源別サンキー構造**
   ```
   Column 1: 財源（租税、公債金、保険料、繰入、その他）
   Column 2: 会計区分（一般会計、特別会計）
   Column 3: 府省庁
   Column 4: 事業
   Column 5: 支出先
   ```

3. **実装内容**
   - 財源を起点としたデータ集計ロジック
   - 新しいサンキー生成関数
   - 専用UIページ (`/sankey/funding` または `/funding-view`)
   - 財源間の相互作用の可視化

#### Phase 5は以下の条件で実装

- [ ] Phase 1-4が完了し、ユーザーフィードバックを収集
- [ ] 財源別ビューの需要が確認される
- [ ] リソース（開発時間）が確保できる

---

## 5. データ検証とテスト計画

### 5.1 単体テスト

#### テストケース

```typescript
// __tests__/funding-allocator.test.ts

describe('FundingAllocator', () => {
  test('一般会計プロジェクトの財源按分が正しい', () => {
    const project: BudgetRecord = {
      accountType: '一般会計',
      totalBudget: 1000000000000, // 1兆円
      // ...
    };

    const funding = allocateFundingToProject(project, mockMOFData);

    expect(funding.taxRevenue).toBeCloseTo(599000000000, -9); // 0.599兆円
    expect(funding.publicBonds).toBeCloseTo(311000000000, -9); // 0.311兆円
    expect(funding.total).toBe(1000000000000);
  });

  test('年金特別会計プロジェクトの財源按分が正しい', () => {
    const project: BudgetRecord = {
      accountType: '特別会計',
      specialAccount: '年金特別会計',
      totalBudget: 1000000000000, // 1兆円
      // ...
    };

    const funding = allocateFundingToProject(project, mockMOFData);

    expect(funding.insurancePremiums).toBeCloseTo(730000000000, -9); // 0.73兆円
    expect(funding.transferFromGeneral).toBeCloseTo(270000000000, -9); // 0.27兆円
    expect(funding.total).toBe(1000000000000);
  });

  test('全プロジェクトの財源合計が予算総額と一致', () => {
    const allFunding = budgetRecords.map(r =>
      allocateFundingToProject(r, mockMOFData)
    );

    const totalFunding = allFunding.reduce(
      (sum, f) => sum + f.total,
      0
    );

    const totalBudget = budgetRecords.reduce(
      (sum, r) => sum + r.totalBudget,
      0
    );

    expect(totalFunding).toBeCloseTo(totalBudget, -9);
  });
});
```

### 5.2 統合テスト

#### 検証項目

| テスト項目 | 検証内容 | 期待値 |
|-----------|---------|--------|
| 財源総額 | 全財源ノードの合計 | 151.1兆円 |
| 租税 | 租税ノードの金額 | 約43.5兆円 |
| 公債金 | 公債金ノードの金額 | 約22.6兆円 |
| 社会保険料 | 保険料ノードの金額 | 約54.2兆円 |
| 一般会計繰入 | 繰入ノードの金額 | 約18.6兆円 |
| その他 | その他ノードの金額 | 約12.2兆円 |
| リンク整合性 | 財源→予算総計のリンク合計 | 151.1兆円 |

#### テストスクリプト

```bash
# scripts/validate-funding-data.ts

import { rs2024Data } from '../public/data/rs2024-structured.json';
import { mofData } from '../public/data/mof-funding-sources-2023.json';

// 1. 財源合計チェック
const totalFunding = calculateTotalFunding(rs2024Data);
console.assert(
  Math.abs(totalFunding - 151.1e12) < 1e9,
  `財源合計が一致しません: ${totalFunding / 1e12}兆円`
);

// 2. 各財源のチェック
const fundingBreakdown = aggregateFundingSources(rs2024Data);
console.assert(
  Math.abs(fundingBreakdown.taxRevenue - 43.5e12) < 0.5e12,
  `租税が範囲外: ${fundingBreakdown.taxRevenue / 1e12}兆円`
);

// 3. 府省庁別集計チェック
for (const ministry of rs2024Data.budgetTree.ministries) {
  const ministryFunding = calculateMinistryFunding(ministry, rs2024Data);
  console.assert(
    Math.abs(ministryFunding.total - ministry.totalBudget) < 1e6,
    `${ministry.name}の財源合計が予算額と一致しません`
  );
}

console.log('✅ すべての検証に合格しました');
```

### 5.3 ユーザー受け入れテスト（UAT）

#### テストシナリオ

1. **シナリオ1: 財源の全体像を把握する**
   - サンキー図を開く
   - 左端に財源ノードが表示されることを確認
   - 各財源の金額と割合を確認
   - 注記が表示されることを確認

2. **シナリオ2: 厚生労働省の財源構成を確認する**
   - 厚生労働省ノードにマウスオーバー
   - ツールチップに財源内訳が表示されることを確認
   - 一般会計と特別会計の区分が表示されることを確認
   - 社会保険料が大部分を占めることを確認

3. **シナリオ3: 公債金の使途を確認する**
   - 公債金ノードにマウスオーバー
   - どの府省庁に配分されているか確認
   - 注記（将来世代の負担）が表示されることを確認

4. **シナリオ4: ヘルプダイアログを確認する**
   - 「財源について」ボタンをクリック
   - 財源の説明が表示されることを確認
   - 予算の範囲についての説明が表示されることを確認
   - よくある誤解の解説が表示されることを確認

---

## 6. リスク管理

### 6.1 想定されるリスク

| リスク | 影響度 | 発生確率 | 対策 |
|-------|-------|---------|------|
| 按分精度への批判 | 高 | 中 | 明確な注記＋ドキュメント充実 |
| 表示崩れ（6列構成） | 中 | 低 | レスポンシブ対応＋テスト強化 |
| パフォーマンス劣化 | 中 | 低 | データ量変わらず、影響軽微 |
| ユーザー混乱 | 高 | 中 | ヘルプダイアログ＋段階的公開 |

### 6.2 対策詳細

#### 対策1: 按分精度への批判

**問題**: 「財源按分は推定値であり正確ではない」との批判

**対策**:
1. すべての財源表示に「推定値」と明記
2. ドキュメントに按分ロジックを詳細記載
3. GitHub Issueで透明性を確保
4. 将来的には政府公開データの改善を提言

**表示例**:
```
※ 財源内訳は財務省データに基づく推定値です

【按分方法】
- 一般会計: 一般会計全体の財源比率を適用
- 特別会計: 会計種別ごとの財源比率を適用
  - 年金: 保険料73%、税金27%（決算ベース）
  - 労働保険: 保険料97%、税金3%

詳細な按分ロジックは以下をご参照ください:
https://github.com/[repo]/docs/funding-allocation-logic.md
```

#### 対策2: 表示崩れ

**問題**: 6列構成により画面が狭くなる、モバイルで見づらい

**対策**:
1. デスクトップ: margin拡大、最小幅設定
2. モバイル: 横スクロール有効化、ピンチズーム対応
3. タブレット: 中間レイアウト
4. 財源列の表示/非表示トグル機能（将来）

```tsx
const sankeyMargins = {
  desktop: { top: 40, right: 250, bottom: 40, left: 250 },
  tablet: { top: 40, right: 150, bottom: 40, left: 150 },
  mobile: { top: 40, right: 100, bottom: 40, left: 100 },
};

const containerStyle = {
  minWidth: isMobile ? '800px' : '100%',  // 横スクロール
  overflowX: isMobile ? 'auto' : 'visible',
};
```

#### 対策3: ユーザー混乱

**問題**: 新しい情報が追加されることで混乱する

**対策**:
1. **段階的公開**
   - Phase 1: ベータ版として一部ユーザーに公開
   - Phase 2: フィードバック収集・改善
   - Phase 3: 正式公開

2. **オンボーディング**
   - 初回表示時にツアー表示
   - 財源列の意味を簡潔に説明
   - ヘルプボタンを目立つ位置に配置

3. **ドキュメント充実**
   - FAQ追加
   - 用語集追加
   - チュートリアル動画（将来）

---

## 7. ドキュメント整備計画

### 7.1 技術ドキュメント

#### 作成するドキュメント

1. **財源按分ロジック仕様書**
   - ファイル: `docs/20260203_1500_財源按分ロジック仕様.md`
   - 内容: 按分計算式、特別会計ごとの比率、検証方法

2. **財源データ更新手順書**
   - ファイル: `docs/20260203_1600_財源データ更新手順.md`
   - 内容: MOFデータダウンロード、パース、検証、デプロイ

3. **サンキー図仕様更新版**
   - ファイル: `docs/サンキー図可視化仕様書_v2.md`
   - 内容: 6列構成、財源ノード、新しいツールチップ

### 7.2 ユーザー向けドキュメント

#### 作成するドキュメント

1. **財源について - FAQ**
   - ファイル: `docs/user-guide/funding-faq.md`
   - 内容:
     - Q1: 財源内訳は正確ですか？
     - Q2: なぜ推定値なのですか？
     - Q3: 租税と公債金の違いは？
     - Q4: 社会保険料とは何ですか？
     - Q5: なぜ予算総額が556兆円ではなく151兆円なのですか？

2. **よくある誤解と正しい理解**
   - ファイル: `docs/user-guide/common-misconceptions.md`
   - 内容:
     - 「年金は税金の無駄遣い」の誤解
     - 「厚労省が92兆円使っている」の誤解
     - 「国債発行180兆円」の誤解
     - 「公債金 = 国債費」の誤解

3. **用語集**
   - ファイル: `docs/user-guide/glossary.md`
   - 内容:
     - 租税、公債金、社会保険料、一般会計繰入
     - 新規国債、借換債、国債費
     - 一般会計、特別会計、会計区分

---

## 8. 今後の拡張可能性

### 8.1 短期拡張（Phase 5完了後）

1. **年度別比較**
   - 2021-2024年度の財源構成比較
   - 租税・公債金の推移グラフ
   - 保険料依存度の変化

2. **府省庁別財源構成**
   - 各府省庁の財源内訳を円グラフで表示
   - 税金依存度ランキング
   - 保険料依存度ランキング

3. **財源効率性分析**
   - 租税1円あたりの支出先効果
   - 公債金使途の可視化

### 8.2 中長期拡張

1. **国際比較**
   - 主要国の財源構成比較
   - 公債依存度の国際比較
   - 社会保険料負担率の比較

2. **シミュレーション機能**
   - 「租税を10%増やすと？」
   - 「公債金を削減すると？」
   - 財源構成変更の影響シミュレーション

3. **教育コンテンツ**
   - 財政の基礎知識
   - 予算編成プロセス
   - 財源と政策の関係

---

## 9. 成功指標（KPI）

### 9.1 技術的KPI

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| データ整合性 | 100% | 自動検証スクリプト |
| 表示速度 | 初回ロード < 2秒 | Lighthouse |
| エラー発生率 | < 0.1% | Sentry |
| テストカバレッジ | > 80% | Jest coverage |

### 9.2 ユーザー体験KPI

| 指標 | 目標値 | 測定方法 |
|------|--------|---------|
| 財源情報閲覧率 | > 30% | Analytics（ツールチップホバー） |
| ヘルプダイアログ開封率 | > 20% | Analytics（ダイアログ表示） |
| 平均滞在時間 | > 3分 | Analytics |
| 直帰率 | < 40% | Analytics |

### 9.3 教育的KPI（定性）

| 指標 | 測定方法 |
|------|---------|
| ユーザー理解度向上 | ユーザーアンケート（5段階評価） |
| 誤解の減少 | 「年金=税金の無駄遣い」への認識変化 |
| SNS反応 | ポジティブコメント率 |

---

## 10. 実装スケジュール

### 10.1 推奨スケジュール（MVP: Phase 1-3）

| Week | Phase | タスク | 工数 | 担当 |
|------|-------|--------|------|------|
| **Week 1** | Phase 1 | MOFデータパース実装 | 2-3時間 | Dev |
| | Phase 2 (前半) | 財源按分ロジック実装 | 3-4時間 | Dev |
| **Week 2** | Phase 2 (後半) | rs2024-structured.json統合 | 2-4時間 | Dev |
| | Phase 3 (前半) | サンキー生成ロジック修正 | 4-6時間 | Dev |
| **Week 3** | Phase 3 (後半) | UI調整・配色設定 | 4-6時間 | Dev |
| | テスト | 単体テスト・統合テスト | 3-5時間 | Dev |
| **Week 4** | デプロイ準備 | ドキュメント作成 | 2-3時間 | Dev |
| | ベータ公開 | 一部ユーザーへ公開 | - | - |

**合計工数**: 20-31時間

### 10.2 フルスコープ（Phase 1-4）

| Week | Phase | タスク | 工数 |
|------|-------|--------|------|
| Week 1-3 | Phase 1-3 | （上記と同じ） | 20-31時間 |
| **Week 4** | Phase 4 | ツールチップ拡張 | 3-4時間 |
| | | ヘルプダイアログ実装 | 2-4時間 |
| **Week 5** | テスト | UAT実施 | 2-3時間 |
| | ドキュメント | ユーザー向けドキュメント | 3-4時間 |
| | 正式公開 | 全ユーザーへ公開 | - |

**合計工数**: 30-46時間

---

## 11. まとめ

### 11.1 実装の意義

1. **透明性の向上**
   - 予算の財源構成を可視化
   - 税金と保険料の区別を明確化
   - 公債金（借金）への依存度を明示

2. **誤解の防止**
   - 「年金=税金の無駄遣い」という誤解を解消
   - 「厚労省が92兆円使っている」という誤解を解消
   - 「国債発行180兆円」の誤解を解消

3. **市民の財政理解促進**
   - データに基づく議論の基盤
   - 世代間扶養の可視化
   - 財政健全性の認識

### 11.2 重要な注意事項

1. **推定値であることの明示**
   - 財源按分は推定値
   - すべての表示に注記を付ける
   - ドキュメントで透明性を確保

2. **予算範囲の明示**
   - RS対象範囲は151.1兆円（27.2%）
   - 国債費・地方財源等は含まれない
   - ユーザーが誤解しないよう注記

3. **継続的な改善**
   - ユーザーフィードバックの収集
   - データ精度の向上
   - UI/UXの改善

### 11.3 次のアクション

#### 即座に着手

- [ ] Phase 1: MOFデータパース実装（2-3時間）
- [ ] Phase 2: 財源按分ロジック実装（5-8時間）

#### Week 2-3で実装

- [ ] Phase 3: サンキー図への歳入列追加（8-12時間）

#### Week 4-5で実装（推奨）

- [ ] Phase 4: ツールチップへの財源情報表示（5-8時間）

#### 将来検討

- [ ] Phase 5: 財源別ビュー（別画面）（20-30時間）

---

**作成者**: Claude Sonnet 4.5
**作成日**: 2026年2月3日 14:00
**関連ドキュメント**:
- [20260201_0400_MOF財源データ分析結果.md](20260201_0400_MOF財源データ分析結果.md)
- [20260201_0500_MOF財源データ分析結果_Opusレビュー.md](20260201_0500_MOF財源データ分析結果_Opusレビュー.md)
- [20260201_1200_MOFとRSデータの対応関係と歳入列設計.md](20260201_1200_MOFとRSデータの対応関係と歳入列設計.md)
- [20260202_0000_MOF予算全体とRS対象範囲の可視化.md](20260202_0000_MOF予算全体とRS対象範囲の可視化.md)

**バージョン**: 1.0
**ステータス**: レビュー待ち
