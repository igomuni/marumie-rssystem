# MOF予算全体ビュー実装計画

**作成日**: 2026年2月4日
**目的**: MOF予算全体（556.3兆円）とRS対象範囲（151.1兆円）を可視化する新しいサンキー図ビューの実装
**基盤**: [docs/20260202_0000_MOF予算全体とRS対象範囲の可視化.md](20260202_0000_MOF予算全体とRS対象範囲の可視化.md)

---

## 1. 概要

### 1.1 目的

財務省の予算全体（556.3兆円）を財源詳細から最終的な支出先まで、一貫したフローで可視化する。

### 1.2 主な特徴

1. **財源の詳細分解**
   - 租税を税目別に表示（消費税、所得税、法人税等）
   - 社会保険料の内訳表示
   - 公債金（国債）の明示

2. **予算の流れの可視化**
   - 財源 → 会計区分（一般/特別） → RS対象区分 → 詳細内訳

3. **RS対象範囲の明示**
   - 事業レビュー対象（151.1兆円）
   - 対象外（405.2兆円）の内訳

---

## 2. サンキー図の構造設計

### 2.1 6列構成

```
Column 1: 財源詳細（税目別、保険料、公債金等）
  ↓
Column 2: 会計区分（一般会計 vs 特別会計）
  ↓
Column 3: RS対象区分（RS対象 vs RS対象外）
  ↓
Column 4: 詳細内訳（国債費、地方交付税、年金事業等）
  ↓
Column 5: RS集約（RSシステム vs RS対象外）
  ↓
Column 6: （オプション）既存サンキーへの接続
```

### 2.2 Column 1: 財源詳細

#### 一般会計財源（114.4兆円）

| 財源 | 金額 | 備考 |
|------|------|------|
| **租税（詳細）** | **68.46兆円** | - |
| └ 消費税 | 23.38兆円 | 最大の税収源 |
| └ 所得税 | 21.05兆円 | 個人所得課税 |
| └ 法人税 | 14.60兆円 | 企業利益課税 |
| └ 相続税 | 2.78兆円 | 資産課税 |
| └ 揮発油税 | 2.00兆円 | ガソリン税 |
| └ その他税 | 4.65兆円 | 酒税、関税等 |
| **公債金** | **35.62兆円** | 新規国債発行 |
| **印紙収入** | **0.98兆円** | 印紙税 |
| **その他収入** | **9.32兆円** | 諸収入、納付金等 |

#### 特別会計財源（主要項目）

| 財源 | 金額 | 備考 |
|------|------|------|
| **社会保険料** | **50.17兆円** | - |
| └ 年金保険料 | 約37.75兆円 | 厚生年金+国民年金 |
| └ 労働保険料 | 約3.65兆円 | 雇用保険+労災 |
| └ その他保険料 | 約8.77兆円 | - |
| **一般会計繰入** | **32.51兆円** | 税金から補填 |
| **公債金（借換債）** | **165.12兆円** | 既存国債の借り換え |
| **他会計繰入** | **81.32兆円** | 特別会計間の資金移動 |
| **その他** | **112.78兆円** | 借入金、拠出金等 |

### 2.3 Column 2: 会計区分

```
一般会計: 114.4兆円（20.6%）
├─ 財源: 租税68.46兆円 + 公債金35.62兆円 + その他10.32兆円
└─ 用途: 事業予算、国債費、地方交付税等

特別会計: 441.9兆円（79.4%）
├─ 財源: 保険料50.17兆円 + 公債金165.12兆円 + 繰入113.83兆円 + その他112.78兆円
└─ 用途: 年金、労働保険、国債整理、地方交付税配付金等

※ 重複を除くと実質的な予算規模は異なる
```

### 2.4 Column 3: RS対象区分

```
【一般会計】114.4兆円
├─ RS対象: 72.56兆円（63.4%）
│  └─ 事業として計上された予算
└─ RS対象外: 41.84兆円（36.6%）
   ├─ 国債費: 25.25兆円
   ├─ 地方交付税: 16.40兆円
   └─ 予備費等: 0.19兆円

【特別会計】441.9兆円
├─ RS対象: 78.56兆円（17.8%）
│  ├─ 年金事業: 68.52兆円
│  ├─ 労働保険: 4.35兆円
│  └─ その他: 5.69兆円
└─ RS対象外: 363.35兆円（82.2%）
   ├─ 国債整理基金: 239.47兆円
   ├─ 地方交付税配付金: 49.54兆円
   ├─ 財政投融資: 24.94兆円
   ├─ 年金給付等: 31.0兆円
   └─ その他: 18.40兆円
```

### 2.5 Column 4: 詳細内訳

#### RS対象外の主要項目

| カテゴリ | 金額 | 説明 |
|---------|------|------|
| 国債整理基金 | 239.47兆円 | 借換債が大部分 |
| 国債費 | 25.25兆円 | 国債の利払い・償還 |
| 地方交付税 | 16.40兆円 | 地方自治体への財源移転 |
| 地方交付税配付金 | 49.54兆円 | 特別会計からの配付 |
| 財政投融資 | 24.94兆円 | 融資・投資活動 |
| 年金給付等 | 31.0兆円 | 受給者への給付 |

#### RS対象の主要項目

| カテゴリ | 金額 | 説明 |
|---------|------|------|
| 年金事業 | 68.52兆円 | 年金制度の運営 |
| 労働保険 | 4.35兆円 | 雇用保険、労災保険 |
| 一般会計事業 | 72.56兆円 | 各府省庁の事業 |

### 2.6 Column 5: RS集約

```
RSシステム: 151.1兆円（27.2%）
└─ 事業レビュー対象（政策的支出）

RS対象外: 405.2兆円（72.8%）
├─ 国債関連: 264.72兆円（65.3%）
├─ 地方財源: 65.94兆円（16.3%）
├─ 年金給付等: 31.0兆円（7.6%）
├─ 財政投融資: 24.94兆円（6.2%）
└─ その他: 18.59兆円（4.6%）
```

---

## 3. データ構造設計

### 3.1 型定義

```typescript
// types/mof-budget-overview.ts

import type { SankeyNode, SankeyLink } from '@/types/sankey';

/**
 * MOF予算全体ビューのノード種別
 */
export type MOFBudgetNodeType =
  | 'tax-detail'           // 税目別（消費税、所得税等）
  | 'public-bonds'         // 公債金
  | 'insurance-premium'    // 社会保険料
  | 'other-revenue'        // その他収入
  | 'account-type'         // 会計区分（一般/特別）
  | 'rs-category'          // RS対象区分
  | 'budget-detail'        // 詳細内訳
  | 'rs-summary'           // RS集約
  | 'other';               // その他

/**
 * MOF予算全体ビューのノード詳細
 */
export interface MOFBudgetNodeDetails {
  // 税目別ノード
  taxType?: '消費税' | '所得税' | '法人税' | '相続税' | '揮発油税' | 'その他税';
  taxRate?: number;        // 税率（該当する場合）

  // 会計区分ノード
  accountType?: '一般会計' | '特別会計';
  rsTargetAmount?: number; // RS対象額
  rsExcludedAmount?: number; // RS対象外額
  rsTargetRate?: number;   // RS対象率

  // RS対象区分ノード
  category?: 'RS対象' | 'RS対象外';
  parentAccount?: '一般会計' | '特別会計';

  // 詳細内訳ノード
  detailType?: '国債費' | '地方交付税' | '年金事業' | '労働保険' | 'その他';
  isRSTarget?: boolean;    // RS対象かどうか

  // 共通
  description?: string;    // 説明文
  sourceType?: string;     // 財源種別
}

/**
 * MOF予算全体ビューのサンキーデータ
 */
export interface MOFBudgetOverviewData {
  metadata: {
    generatedAt: string;
    fiscalYear: number;
    totalBudget: number;      // MOF予算総額
    rsTargetBudget: number;   // RS対象予算
    rsExcludedBudget: number; // RS対象外予算
    dataSource: string;
  };
  sankey: {
    nodes: (SankeyNode & { details?: MOFBudgetNodeDetails })[];
    links: SankeyLink[];
  };
  summary: {
    generalAccount: {
      total: number;
      rsTarget: number;
      rsExcluded: number;
      rsTargetRate: number;
    };
    specialAccount: {
      total: number;
      rsTarget: number;
      rsExcluded: number;
      rsTargetRate: number;
    };
  };
}
```

### 3.2 データソース

#### 必要なデータファイル

1. **MOF 2023年度データ**
   - `data/download/mof_2023/DL202311001a.csv` (一般会計歳入)
   - `data/download/mof_2023/DL202312001a.csv` (特別会計歳入)
   - `data/download/mof_2023/DL202311001b.csv` (一般会計歳出)
   - `data/download/mof_2023/DL202312001b.csv` (特別会計歳出)

2. **RS 2024年度データ**
   - `public/data/rs2024-structured.json` (既存)

3. **分析結果データ**
   - 既存の分析スクリプト結果を活用

---

## 4. 実装計画

### 4.1 Phase 1: データ準備（2-3時間）

#### タスク

1. **MOFデータ読み込みスクリプト作成**
   ```bash
   scripts/generate-mof-budget-overview-data.ts
   ```

2. **データ集計**
   - 租税収入の税目別集計
   - 特別会計の財源別集計
   - RS対象/対象外の金額集計

3. **JSONファイル出力**
   ```
   public/data/mof-budget-overview-2023.json
   ```

#### 検証項目

- [ ] 一般会計合計 = 114.38兆円
- [ ] 特別会計合計 = 441.9兆円（重複含む）
- [ ] 租税合計 = 68.46兆円
- [ ] 社会保険料合計 = 50.17兆円
- [ ] RS対象合計 = 151.1兆円

### 4.2 Phase 2: APIエンドポイント実装（3-4時間）

#### ファイル構成

```
app/api/sankey/mof-overview/
└── route.ts
```

#### 実装内容

```typescript
// app/api/sankey/mof-overview/route.ts

import { NextRequest, NextResponse } from 'next/server';
import type { MOFBudgetOverviewData } from '@/types/mof-budget-overview';

export async function GET(request: NextRequest) {
  try {
    // MOFデータ読み込み
    const mofData = await loadMOFBudgetOverviewData();

    // サンキー図データ生成
    const sankeyData = generateMOFBudgetOverviewSankey(mofData);

    return NextResponse.json(sankeyData);
  } catch (error) {
    return NextResponse.json(
      { error: 'Failed to generate MOF budget overview data' },
      { status: 500 }
    );
  }
}
```

#### サンキー生成ロジック

```typescript
// app/lib/mof-sankey-generator.ts

export function generateMOFBudgetOverviewSankey(
  mofData: MOFData
): MOFBudgetOverviewData {
  const nodes: SankeyNode[] = [];
  const links: SankeyLink[] = [];

  // Column 1: 財源詳細ノード
  nodes.push(...createRevenueDetailNodes(mofData));

  // Column 2: 会計区分ノード
  nodes.push(...createAccountTypeNodes(mofData));

  // Column 3: RS対象区分ノード
  nodes.push(...createRSCategoryNodes(mofData));

  // Column 4: 詳細内訳ノード
  nodes.push(...createBudgetDetailNodes(mofData));

  // Column 5: RS集約ノード
  nodes.push(...createRSSummaryNodes(mofData));

  // リンク生成
  links.push(...createRevenueToAccountLinks(nodes));
  links.push(...createAccountToRSCategoryLinks(nodes));
  links.push(...createRSCategoryToDetailLinks(nodes));
  links.push(...createDetailToSummaryLinks(nodes));

  return {
    metadata: { /* ... */ },
    sankey: { nodes, links },
    summary: { /* ... */ },
  };
}
```

### 4.3 Phase 3: UIページ実装（5-6時間）

#### ファイル構成

```
app/mof-budget-overview/
├── page.tsx
└── loading.tsx (オプション)
```

#### 実装内容

```tsx
// app/mof-budget-overview/page.tsx

'use client';

import { useState, useEffect } from 'react';
import { ResponsiveSankey } from '@nivo/sankey';
import type { MOFBudgetOverviewData } from '@/types/mof-budget-overview';
import LoadingSpinner from '@/client/components/LoadingSpinner';

export default function MOFBudgetOverviewPage() {
  const [data, setData] = useState<MOFBudgetOverviewData | null>(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    fetchData();
  }, []);

  async function fetchData() {
    try {
      const response = await fetch('/api/sankey/mof-overview');
      if (!response.ok) throw new Error('Failed to fetch data');
      const result = await response.json();
      setData(result);
    } catch (err) {
      setError((err as Error).message);
    } finally {
      setLoading(false);
    }
  }

  if (loading) return <LoadingSpinner />;
  if (error) return <div>Error: {error}</div>;
  if (!data) return <div>No data</div>;

  return (
    <div className="min-h-screen bg-gray-50 p-4">
      <header className="mb-6">
        <h1 className="text-3xl font-bold">MOF予算全体ビュー</h1>
        <p className="text-gray-600 mt-2">
          財務省予算総額（556.3兆円）とRS対象範囲（151.1兆円）の可視化
        </p>
      </header>

      <div className="bg-white rounded-lg shadow-lg p-6">
        <div style={{ height: '800px' }}>
          <ResponsiveSankey
            data={data.sankey}
            margin={{ top: 40, right: 250, bottom: 40, left: 250 }}
            align="justify"
            colors={getNodeColor}
            nodeOpacity={1}
            nodeHoverOthersOpacity={0.35}
            linkOpacity={0.5}
            linkHoverOthersOpacity={0.1}
            enableLinkGradient
            label={(node) => `${node.name}\n${formatBudget(node.value)}`}
            // ツールチップ設定
            // ...
          />
        </div>
      </div>

      {/* サマリー情報 */}
      <SummaryPanel summary={data.summary} metadata={data.metadata} />

      {/* 説明パネル */}
      <ExplanationPanel />
    </div>
  );
}
```

#### 配色設定

```typescript
function getNodeColor(node: SankeyNode): string {
  const details = node.details as MOFBudgetNodeDetails | undefined;

  // 税目別
  if (node.type === 'tax-detail') {
    return '#10b981'; // 緑（持続可能な財源）
  }

  // 公債金
  if (node.type === 'public-bonds') {
    return '#ef4444'; // 赤（将来世代の負担）
  }

  // 社会保険料
  if (node.type === 'insurance-premium') {
    return '#3b82f6'; // 青（社会保険料）
  }

  // 一般会計
  if (details?.accountType === '一般会計') {
    return '#bbdefb'; // 薄青
  }

  // 特別会計
  if (details?.accountType === '特別会計') {
    return '#90caf9'; // 青
  }

  // RS対象
  if (details?.category === 'RS対象') {
    return '#81c784'; // 緑
  }

  // RS対象外
  if (details?.category === 'RS対象外') {
    return '#ef9a9a'; // 薄赤
  }

  return '#9ca3af'; // デフォルト（グレー）
}
```

### 4.4 Phase 4: ナビゲーション追加（1時間）

#### ホームページにリンク追加

```tsx
// app/page.tsx

<Link href="/mof-budget-overview">
  <Card>
    <h2>MOF予算全体ビュー</h2>
    <p>
      財務省予算総額（556.3兆円）とRS対象範囲（151.1兆円）を
      財源詳細から支出先まで一貫して可視化
    </p>
  </Card>
</Link>
```

---

## 5. 注記事項（重要）

### 5.1 データの重複について

特別会計の予算総額441.9兆円には以下の重複が含まれています:

1. **会計間繰入の重複**: 81.32兆円
   - 特別会計から別の特別会計への資金移動
   - 実際の財源ではなく帳簿上の移動

2. **借換債の重複**: 165.12兆円
   - 既存国債の借り換えによる収入
   - 新しい財源ではない

**実質的な予算規模**:
- 純計: 約300兆円（重複除去後）
- ただし、本ビューでは「予算書上の金額」を表示

### 5.2 表示時の注記

すべてのビューに以下の注記を表示:

```
【重要な注意事項】

1. 予算総額556.3兆円は「予算書上の金額」です
   - 特別会計間の資金移動（81.3兆円）が含まれます
   - 借換債（165.1兆円）が含まれます
   - 実質的な予算規模は約300兆円です

2. RS対象範囲は「事業レビュー対象」のみです（151.1兆円）
   - 国債費・国債整理基金（264.7兆円）は含まれません
   - 地方交付税・配付金（65.9兆円）は含まれません
   - 年金・保険給付金（31.0兆円）は含まれません

3. データ年度について
   - MOFデータ: 2023年度（令和5年度）当初予算
   - RSデータ: 2024年度レビューシート（2023年度予算ベース）

4. 財源の流れについて
   - 租税→一般会計の流れは実際の資金フロー
   - 一般会計→特別会計の繰入は税金由来
   - 保険料は独立した財源（税金ではない）
```

---

## 6. テスト計画

### 6.1 データ整合性テスト

```typescript
describe('MOF Budget Overview Data', () => {
  test('総予算額が556.3兆円', () => {
    const total = calculateTotalBudget(mofData);
    expect(total).toBeCloseTo(556.3e12, -9);
  });

  test('一般会計合計が114.4兆円', () => {
    const generalAccount = calculateGeneralAccount(mofData);
    expect(generalAccount).toBeCloseTo(114.4e12, -9);
  });

  test('RS対象合計が151.1兆円', () => {
    const rsTarget = calculateRSTarget(mofData);
    expect(rsTarget).toBeCloseTo(151.1e12, -9);
  });

  test('ノードの合計値とリンクの合計値が一致', () => {
    const nodeSum = sumNodeValues(sankeyData.nodes);
    const linkSum = sumLinkValues(sankeyData.links);
    expect(nodeSum).toBeCloseTo(linkSum, -6);
  });
});
```

### 6.2 UI表示テスト

- [ ] デスクトップ表示: 正常に表示される
- [ ] モバイル表示: 横スクロール可能
- [ ] ツールチップ: 正しい情報が表示される
- [ ] 配色: 財源別に適切な色が適用される
- [ ] ラベル: 読みやすい位置に表示される

---

## 7. 実装スケジュール

| Week | Phase | タスク | 工数 |
|------|-------|--------|------|
| Week 1 | Phase 1 | データ準備スクリプト作成 | 2-3時間 |
| | Phase 2 (前半) | APIエンドポイント実装 | 2-3時間 |
| Week 2 | Phase 2 (後半) | サンキー生成ロジック実装 | 1-2時間 |
| | Phase 3 (前半) | UIページ基本実装 | 3-4時間 |
| Week 3 | Phase 3 (後半) | ツールチップ・配色調整 | 2-3時間 |
| | Phase 4 | ナビゲーション追加 | 1時間 |
| | テスト | データ整合性・UI表示確認 | 2-3時間 |

**合計工数**: 13-19時間

---

## 8. 期待される効果

### 8.1 理解の促進

1. **予算全体像の把握**
   - MOF予算総額556.3兆円の全体像
   - RS対象範囲151.1兆円の位置づけ

2. **財源構成の理解**
   - 税目別の財源内訳
   - 社会保険料の役割
   - 公債金（国債）の依存度

3. **予算配分の理解**
   - 一般会計と特別会計の違い
   - RS対象/対象外の区分
   - 国債費・地方交付税の規模感

### 8.2 誤解の防止

| 誤解 | 正しい理解 |
|------|----------|
| 「予算総額は556兆円」 | 重複を除くと実質約300兆円 |
| 「RSシステムで全予算が見られる」 | RS対象は27.2%（151.1兆円）のみ |
| 「国債発行180兆円」 | 新規は35兆円、残り145兆円は借換債 |
| 「特別会計は不透明」 | 予算書で公開されているが読みにくい |

---

## 9. 将来の拡張可能性

### 9.1 短期拡張

1. **年度比較機能**
   - 2021-2024年度の推移
   - 財源構成の変化
   - RS対象率の変化

2. **ドリルダウン機能**
   - 租税ノードクリック → 税目別詳細
   - 特別会計ノードクリック → 会計別詳細
   - RS対象ノードクリック → 既存サンキーへ遷移

3. **フィルタリング機能**
   - 金額閾値設定（XX兆円以上のみ表示）
   - 特定財源のみ表示（例: 税金のみ）
   - 特定会計のみ表示（例: 一般会計のみ）

### 9.2 中長期拡張

1. **予算vs決算比較**
   - 同一画面で予算・決算を並列表示
   - 差分のハイライト

2. **国際比較**
   - 他国の予算構造との比較
   - 財源構成の国際比較

3. **シミュレーション機能**
   - 税収変動のシミュレーション
   - 国債削減のシミュレーション

---

## 10. まとめ

### 10.1 実装の意義

1. **全体像の可視化**
   - 財務省予算の全体像を一目で把握
   - 財源から支出先までの一貫した流れ

2. **RS対象範囲の明確化**
   - 事業レビュー対象が27.2%であることの明示
   - 対象外の内訳（国債、地方財源等）の説明

3. **教育的価値**
   - 財政の仕組みの理解促進
   - 誤解の防止

### 10.2 次のアクション

1. Phase 1: データ準備スクリプト作成（2-3時間）
2. Phase 2: APIエンドポイント実装（3-4時間）
3. Phase 3: UIページ実装（5-6時間）
4. Phase 4: ナビゲーション追加（1時間）

---

**作成者**: Claude Sonnet 4.5
**作成日**: 2026年2月4日
**データソース**:
- [docs/20260202_0000_MOF予算全体とRS対象範囲の可視化.md](20260202_0000_MOF予算全体とRS対象範囲の可視化.md)
- 財務省 令和5年度予算（2023年度）
- RSシステム 2024年度レビューシート

**バージョン**: 1.0
**ステータス**: レビュー待ち
