# 支出先ラベリング辞書データ構築レポート

作成日: 2026-02-22

## 概要

`data/result/recipients_without_total.csv`（98,599行）を SQLite DB 化し、支出先名の完全一致ラベリングに使用する辞書 CSV を生成した。

---

## 1. SQLite DB 化

### 出力ファイル

| ファイル | サイズ | 行数 |
|----------|--------|------|
| `data/result/recipients.db` | 45.8 MB | 98,599行 |

### スキーマ（テーブル: `recipients`）

| 列名 | 型 | 元CSV列名 |
|------|----|-----------|
| `project_id` | INTEGER | 予算事業ID |
| `ministry` | TEXT | 府省庁 |
| `bureau` | TEXT | 局・庁 |
| `recipient_name` | TEXT | 支出先名 |
| `corporate_number` | TEXT | 法人番号 |
| `amount` | INTEGER | 金額（円） |
| … | … | … |

インデックス: `project_id`, `corporate_number`, `recipient_name`, `ministry`, `amount`

生成スクリプト: `scripts/csv-to-sqlite.py`

---

## 2. 辞書 CSV の構築

### 2-1. 国名辞書

**ファイル:** `data/result/country_names.csv`

| 列 | 内容 |
|----|------|
| `country_id` | ISO 3166-1 alpha-2コード（us, cn, kr…） |
| `canonical_name` | 外務省基準の正式名称 |
| `name` | マッチング用名称（正式名称または別名） |
| `name_type` | `canonical` / `alias` |

**統計:**
- 対象国数: 199か国（ISO主権国家197か国 + クック諸島・ニウエ）
- 総行数: 398行（重複なし）
- 別名の例: アメリカ合衆国↔アメリカ/米国、イギリス↔英国/グレートブリテン及び北部アイルランド連合王国

**ISO 3166-1 alpha-2 網羅状況:** 不足なし ✓（独自追加2件: ck/nu）

**実データ照合結果:** 24件ヒット（ウクライナ224億円、カンボジア72億円など ODA・無償資金協力が中心）

生成スクリプト: `scripts/generate-country-names.py`

---

### 2-2. 都道府県・市区町村辞書

**ファイル1:** `data/result/prefecture_names.csv`

| 列 | 内容 |
|----|------|
| `pref_code` | JIS X 0401コード（01〜47） |
| `canonical_name` | 正式名称（東京都、大阪府…） |
| `name` | マッチング用名称 |
| `name_type` | `canonical` / `alias` |

- 47都道府県 + 通称（「東京」「大阪」等）= 93行

**ファイル2:** `data/result/municipality_names.csv`

| 列 | 内容 |
|----|------|
| `pref_code` | 都道府県コード |
| `prefecture_name` | 都道府県名 |
| `canonical_name` | 市区町村名（完全形） |
| `name` | マッチング用名称 |
| `name_type` | `canonical` / `alias` |

- 1,958市区町村 + 郡なし短縮形alias 973件 = 2,931行（重複なし）
- alias例: `三重郡川越町` → `川越町`、`三宅島三宅村` → `三宅村`

**データソース:** `data/houjin.db`（国税庁法人番号データ）の `(prefecture, city)` カラム
- 法人番号データは常に**現在の住所**で管理されるため、廃止済み自治体は含まない
- 政令指定都市の区（`さいたま市浦和区`、`大阪市中央区`等）も収録

**実データ照合結果:**
- 都道府県: 51件ヒット
- 市区町村: 994件ヒット

生成スクリプト: `scripts/generate-prefecture-municipality-names.py`

---

### 2-3. 府省庁一覧PDF辞書

**ファイル:** `data/result/ministry_from_ichiran.csv`

| 列 | 内容 |
|----|------|
| `ministry` | 府省庁名（例: 法務省） |
| `category` | 分類（本省内部部局 / 地方支分部局 / 施設等機関 / 外局 / 特別の機関） |
| `bureau` | 局・庁・管区等の組織名（展開済み完全名称） |
| `bureau_alias` | 別名（`地方` 含む名称の短縮形など） |
| `section` | 課・室等（一部収録） |
| `expanded_from` | 展開元の原文表記（`＜...＾` 展開時に記録） |

**ソース:** `r071215kouji.pdf`（行政機構図、令和7年12月15日公示版）

**統計:**
- 総行数: 1,702行
- 対象府省庁: 35機関
- `＜...＾` 展開件数: 264件（地方支分部局名の自動展開）
- alias付きエントリ: 41件

**展開ロジックの概要:**

PDFは文字スペース区切りで抽出されるため、`高等検察庁８` `＜札幌、仙台…福岡＾` の形式を解析して `札幌高等検察庁`…`福岡高等検察庁` と展開する。以下の2つのバグを修正済み:

1. **`矯正管区` 未認識**: `ORG_ENDS` パターンに `区` が未登録 → 追加修正
2. **ページ跨ぎ兄弟展開**: `矯正管区８`（ページ17末尾）が次ページ（18ページ）の `＜北海道…九州＾` を参照できず、`高等検察庁` の地域リストを誤流用 → `next_is_angle` 計算をページ境界跨ぎ対応に修正

**実データ照合:** `recipients.db` との突合で `bureau_alias` を自動付与（`地方` 含む正式名称 → 短縮形）

生成スクリプト: `scripts/extract-ministry-from-ichiran.py`

詳細: [20260222_1045_省庁一覧CSV抽出スクリプト修正レポート.md](20260222_1045_省庁一覧CSV抽出スクリプト修正レポート.md)

---

### 2-4. 府省庁・組織階層辞書

**ファイル:** `data/result/ministry_names.csv`

| 列 | 内容 |
|----|------|
| `policy_ministry` | 政策所管府省庁 |
| `ministry` | 府省庁 |
| `bureau` | 局・庁 |
| `division` | 部 |
| `section` | 課 |
| `office` | 室 |
| `team` | 班 |
| `unit` | 係 |
| `source` | `data`（実績から自動抽出）/ `supplement`（手動補完） |

**統計:**
- 総行数: 1,795行（data: 1,757 + supplement: 38）
- 府省庁: 46機関
- 局・庁（ユニーク）: 208件
- 課（ユニーク）: 986件

**手動補完した9機関（`source=supplement`）:**

| 機関名 | 区分 | 上位府省庁 |
|--------|------|-----------|
| 会計検査院 | 独立機関 | — |
| 人事院 | 独立機関 | — |
| 宮内庁 | 内閣府外局 | 内閣府 |
| 国家公安委員会 | 内閣府外局 | 内閣府 |
| 資源エネルギー庁 | 経産省外局 | 経済産業省 |
| 中小企業庁 | 経産省外局 | 経済産業省 |
| 国土地理院 | 国交省施設等機関 | 国土交通省 |
| 公安審査委員会 | 法務省外局 | 法務省 |
| 農林水産技術会議 | 農水省審議会等 | 農林水産省 |

生成スクリプト: `scripts/generate-ministry-names.py`

---

## 3. 公式ソース調査結果

局・課・室レベルまで網羅した機械可読な公式 CSV は存在しない。

| ソース | 形式 | 網羅レベル | 備考 |
|--------|------|-----------|------|
| 内閣官房 行政機構図 | PDF | 局レベル | 2025年8月版 |
| e-Gov 法令 API（組織令） | XML | 局・課・室 | 最有望だが系統的な一括取得に多数リクエスト必要 |
| 国の行政機関の定員（Excel）| XLSX | 府省・大括り分野 | 組織名でなく定員数のデータ |

**e-Gov 法令 API の状況:**
- エンドポイント: `https://laws.e-gov.go.jp/api/1/lawlists/{n}`
- 接続確認済み（TLS: Digital Agency 証明書）
- 組織令の法令 ID は法令種別ページ内に分散しており一括取得は困難
- 確認できた法令ID例: 防衛省組織令 `329CO0000000178`、警察庁組織令 `329CO0000000180`

---

## 4. 生成ファイル一覧

```
data/result/
├── recipients.db                   # SQLite DB（支出実績全件）
├── country_names.csv               # 国名辞書（199か国・398行）
├── prefecture_names.csv            # 都道府県辞書（47都道府県・93行）
├── municipality_names.csv          # 市区町村辞書（1,958件・2,931行）
├── ministry_from_ichiran.csv       # 府省庁一覧PDF辞書（1,702行・PDF展開）
└── ministry_names.csv              # 府省庁・組織階層辞書（1,795行・実績抽出）

scripts/
├── csv-to-sqlite.py                # CSV→SQLite変換
├── generate-country-names.py       # 国名辞書生成
├── generate-prefecture-municipality-names.py  # 都道府県・市区町村辞書生成
├── extract-ministry-from-ichiran.py           # 府省庁一覧PDF辞書生成
└── generate-ministry-names.py      # 府省庁辞書生成
```

---

## 5. 次のステップ（案）

1. **国際機関辞書の作成** — UN・World Bank・UNDP 等（既に「国際連合」等がヒット確認済み）
2. **大学・研究機関辞書** — 国立大学法人・国立研究開発法人（支出額トップ層）
3. **ラベリングロジックの実装** — 上記辞書を使った完全一致タグ付けスクリプト
