# 支出先タグ付け体系の提案

**作成日**: 2026年1月31日 11:15
**目的**: 支出先データの可視化と分析を改善するため、組織種別・業種・リスク評価のタグ付け体系を提案する
**データソース**: RS2024構造化データ（12,869支出先）

---

## 1. 背景と目的

### 1.1 現状の課題

現在のシステムでは、支出先は名前と法人種別コード（corporateType）のみで管理されており、以下の課題があります：

1. **視認性の低さ**: 支出先が「自治体」「民間企業」「公益法人」のどれに該当するか一目で判断できない
2. **分析の困難性**: 業種別・組織種別での集計や絞り込みができない
3. **ベンダーロックイン調査の非効率性**: リスク評価が手作業で、再現性が低い

### 1.2 タグ付けの目的

- **可視化の改善**: サンキー図やダイアログで組織種別・業種をバッジ表示
- **フィルタリング機能**: 特定の組織種別や業種に絞った分析を可能に
- **自動リスク評価**: ベンダーロックイン調査を自動化・再現可能に

---

## 2. データ分析結果

### 2.1 法人種別コード（corporateType）の分布

| コード | 件数 | 割合 | 意味 | 主な例 |
|:------|-----:|-----:|:-----|:------|
| 未分類 | 4,912 | 38.2% | コード未設定 | 年金受給者、その他、総務省 |
| 301 | 4,720 | 36.7% | 株式会社等 | 三菱重工業、九州地方整備局 |
| 399 | 1,969 | 15.3% | 公益法人等 | 全国健康保険協会、NEDO、JAXA |
| 201 | 732 | 5.7% | 地方公共団体 | 東京都、大阪府、北海道 |
| 302 | 187 | 1.5% | 有限会社 | 朝日エナジー有限会社 |
| 499 | 132 | 1.0% | その他法人 | 企業年金連合会、共済組合 |
| 101 | 123 | 1.0% | 国の機関 | 国土交通省、文部科学省、防衛局 |
| 305 | 67 | 0.5% | 合同会社 | PwC、デロイトトーマツ |
| 401 | 23 | 0.2% | 外国法人 | AWS、McKinsey |
| 304 | 4 | 0.0% | 合資会社 | 合資会社得月楼 |

**課題**: 法人種別コードだけでは不十分
- 「未分類」が38.2%と最多（個人、省庁、整備局などが混在）
- 「301（株式会社等）」に地方整備局などの行政組織が含まれている

### 2.2 名前パターンによる分類

| カテゴリ | 件数 | 主な例（金額） |
|:---------|-----:|:--------------|
| 株式会社 | 5,462 | 株式会社博報堂（2.5兆円）、三菱重工業（5,593億円） |
| 市区町村 | 715 | 大阪市（4,766億円）、横浜市（3,642億円） |
| 一般社団法人 | 534 | 一般社団法人全国石油協会（2.9兆円） |
| 公益財団法人 | 251 | 公益財団法人児童育成協会（2,079億円） |
| 一般財団法人 | 250 | 一般財団法人工業所有権協力センター（169億円） |
| 組合 | 227 | 日本郵政共済組合（529億円） |
| 大学 | 210 | 国立大学法人東京大学（1,042億円） |
| 有限会社 | 205 | 朝日エナジー有限会社（14億円） |
| 公益社団法人 | 158 | 公益社団法人2025年日本国際博覧会協会（499億円） |
| 協会 | 108 | 全国健康保険協会（12.3兆円） |
| 都道府県 | 106 | 東京都（1.4兆円）、大阪府（1.1兆円） |
| 労働局 | 96 | その他労働局（756億円）、東京労働局（385億円） |
| 独立行政法人 | 86 | 独立行政法人日本学術振興会（3,357億円） |
| 合同会社 | 80 | PwCコンサルティング合同会社（155億円） |
| 特殊法人 | 42 | 日本私立学校振興・共済事業団（4,403億円） |
| 国立研究開発法人 | 41 | NEDO（2.8兆円）、JAXA（5,934億円） |
| 省庁 | 32 | 総務省（2.8兆円）、米空軍省（4,903億円） |
| 農政局 | 23 | 東北農政局（2,019億円）、九州農政局（1,830億円） |
| 地方整備局 | 19 | 関東地方整備局（5,247億円）、九州地方整備局（4,021億円） |
| 森林管理局 | 13 | 東北森林管理局（292億円） |
| 経済産業局 | 11 | 関東経済産業局（44億円） |
| 財務局 | 11 | 関東財務局（40億円） |
| 防衛局 | 8 | 沖縄防衛局（3,447億円） |
| 合資会社 | 4 | 合資会社得月楼（0.1億円） |

---

## 3. タグ付け体系の設計

### 3.1 組織種別タグ（3階層）

#### レベル1: Primary Category（大分類）

```typescript
enum PrimaryCategory {
  GOVERNMENT = 'government',           // 行政組織
  PRIVATE = 'private',                 // 民間企業
  PUBLIC_INTEREST = 'public-interest', // 公益法人等
  INDIVIDUAL_OTHER = 'individual-other' // 個人・その他
}
```

| Primary Category | 件数推定 | 主な特徴 |
|:-----------------|--------:|:---------|
| government | ~1,200 | 国の機関、地方公共団体、整備局等 |
| private | ~6,000 | 株式会社、有限会社、合同会社、外国法人 |
| public-interest | ~3,000 | 法人、財団、独法、特殊法人、大学 |
| individual-other | ~2,700 | 個人（年金受給者等）、未分類 |

#### レベル2: Secondary Category（中分類）

```typescript
// government（行政組織）
enum GovernmentCategory {
  NATIONAL_MINISTRY = '国の機関',        // 省庁、防衛局
  REGIONAL_BUREAU = '地方整備局等',      // 整備局、農政局、森林管理局等
  PREFECTURE = '都道府県',
  MUNICIPALITY = '市区町村',
  LABOR_BUREAU = '労働局'
}

// private（民間企業）
enum PrivateCategory {
  KABUSHIKI_KAISHA = '株式会社',
  YUGEN_KAISHA = '有限会社',
  GODO_KAISHA = '合同会社',
  GOSHI_KAISHA = '合資会社',
  FOREIGN_CORP = '外国法人'
}

// public-interest（公益法人等）
enum PublicInterestCategory {
  NRDO = '国立研究開発法人',
  IAA = '独立行政法人',
  GENERAL_CORP = '一般社団・財団法人',
  PUBLIC_CORP = '公益社団・財団法人',
  SPECIAL_CORP = '特殊法人・機構',
  UNIVERSITY = '大学',
  COOPERATIVE = '組合',
  ASSOCIATION = '協会'
}
```

### 3.2 業種・機能タグ（IndustryTag）

ベンダーロックイン分析に有用な業種分類：

```typescript
enum IndustryTag {
  IT_SYSTEM = 'ITシステム・保守',
  DEFENSE = '防衛・装備',
  CONSTRUCTION = '建設・土木',
  CONSULTING = 'コンサルティング',
  SECRETARIAT = '事務局・BPR',
  EDUCATION = '教育・研究',
  MEDICAL = '医療・保険',
  ENERGY = 'エネルギー',
  FINANCE = '金融',
  LOGISTICS = '物流・運輸',
  PRINTING = '印刷・広告',
  AGRICULTURE = '農林水産',
  MANUFACTURING = '製造',
  OTHER = 'その他'
}
```

**用語解説**:
- **事務局・BPR**: BPRは本来「Business Process Reengineering（業務プロセス再設計）」の略ですが、本調査では「事務局として受託し、実務を外部企業に再委託するモデル」を指します。例: 博報堂が電気・ガス価格激変緩和対策の事務局として2.5兆円を受託し、実際の審査・支払業務は再委託先に振り分ける構造。

**判定ロジック**:
- 名前パターン（例: 「システム」「保守」→ IT_SYSTEM）
- 支出元事業名（例: 「防衛装備」→ DEFENSE）
- 手動ラベリング（必要に応じて）

### 3.3 ベンダーロックインリスク評価タグ

```typescript
enum LockInRisk {
  CRITICAL = 'critical',   // 高リスク: 占有率80%超
  WARNING = 'warning',     // 中リスク: 占有率60-80%
  MONITOR = 'monitor',     // 低リスク: 監視対象
  STRATEGIC = 'strategic'  // 特例: 安全保障等
}
```

**評価基準**（調査フローに基づく）:
- **Critical**: 1社占有80%超 かつ 入札者1社 かつ 年間5,000億円超
- **Warning**: 1社占有60-80% または 入札者2-3社 かつ 落札率95%超
- **Monitor**: 複数社競争あり、占有率50%未満
- **Strategic**: 防衛装備等の安全保障案件（占有率100%でも正当）

---

## 4. データ構造の設計

### 4.1 型定義（types/structured.ts）

```typescript
/**
 * 支出先タグ情報
 */
export interface SpendingTags {
  /** 大分類（自動判定） */
  primaryCategory: PrimaryCategory;

  /** 中分類（自動判定） */
  secondaryCategory: string;

  /** 業種タグ（ルールベース + 手動） */
  industryTags: IndustryTag[];

  /** ベンダーロックインリスク評価（分析結果） */
  lockInRisk?: LockInRisk;

  /** リスク評価の根拠 */
  lockInRiskReason?: string;
}

/**
 * 支出先レコード（拡張）
 */
export interface SpendingRecord {
  spendingId: number;
  spendingName: string;
  corporateNumber: string;
  location: string;
  corporateType: string;
  totalSpendingAmount: number;
  projectCount: number;
  projects: SpendingProject[];
  outflows?: SpendingBlockFlow[];

  /** タグ情報（新規追加） */
  tags?: SpendingTags;
}
```

### 4.2 タグ付けロジック（scripts/tag-classifier.ts）

```typescript
import { SpendingRecord, SpendingTags, PrimaryCategory } from '@/types/structured';

/**
 * 支出先レコードにタグを付与
 */
export function classifySpending(spending: SpendingRecord): SpendingTags {
  const name = spending.spendingName;
  const corporateType = spending.corporateType;

  // 1. Primary & Secondary Category（組織種別）
  const { primaryCategory, secondaryCategory } = detectOrganizationType(name, corporateType);

  // 2. Industry Tags（業種）
  const industryTags = detectIndustryTags(spending);

  // 3. Lock-In Risk（リスク評価、必要に応じて後で設定）
  const lockInRisk = undefined; // 別途分析で設定

  return {
    primaryCategory,
    secondaryCategory,
    industryTags,
    lockInRisk
  };
}

/**
 * 組織種別の判定
 */
function detectOrganizationType(
  name: string,
  corporateType: string
): { primaryCategory: PrimaryCategory; secondaryCategory: string } {

  // 行政組織の判定
  if (corporateType === '101' || /省$/.test(name) || /.*防衛局$/.test(name)) {
    return {
      primaryCategory: 'government',
      secondaryCategory: '国の機関'
    };
  }

  if (/地方整備局$|農政局$|森林管理局$|経済産業局$/.test(name)) {
    return {
      primaryCategory: 'government',
      secondaryCategory: '地方整備局等'
    };
  }

  if (/労働局$/.test(name)) {
    return {
      primaryCategory: 'government',
      secondaryCategory: '労働局'
    };
  }

  if (corporateType === '201' || /^.*[都道府県]$/.test(name)) {
    return {
      primaryCategory: 'government',
      secondaryCategory: '都道府県'
    };
  }

  if (/^.*[市区町村]$/.test(name)) {
    return {
      primaryCategory: 'government',
      secondaryCategory: '市区町村'
    };
  }

  // 民間企業の判定
  if (corporateType === '301' || /株式会社/.test(name)) {
    // 301の中にも行政組織が混じっているので名前で再判定
    if (/地方整備局$|農政局$|森林管理局$/.test(name)) {
      return {
        primaryCategory: 'government',
        secondaryCategory: '地方整備局等'
      };
    }
    return {
      primaryCategory: 'private',
      secondaryCategory: '株式会社'
    };
  }

  if (corporateType === '302' || /有限会社/.test(name)) {
    return {
      primaryCategory: 'private',
      secondaryCategory: '有限会社'
    };
  }

  if (corporateType === '305' || /合同会社/.test(name)) {
    return {
      primaryCategory: 'private',
      secondaryCategory: '合同会社'
    };
  }

  if (corporateType === '304' || /合資会社/.test(name)) {
    return {
      primaryCategory: 'private',
      secondaryCategory: '合資会社'
    };
  }

  if (corporateType === '401') {
    return {
      primaryCategory: 'private',
      secondaryCategory: '外国法人'
    };
  }

  // 公益法人等の判定
  if (/国立研究開発法人/.test(name)) {
    return {
      primaryCategory: 'public-interest',
      secondaryCategory: '国立研究開発法人'
    };
  }

  if (/独立行政法人/.test(name)) {
    return {
      primaryCategory: 'public-interest',
      secondaryCategory: '独立行政法人'
    };
  }

  if (/一般社団法人|一般財団法人/.test(name)) {
    return {
      primaryCategory: 'public-interest',
      secondaryCategory: '一般社団・財団法人'
    };
  }

  if (/公益社団法人|公益財団法人/.test(name)) {
    return {
      primaryCategory: 'public-interest',
      secondaryCategory: '公益社団・財団法人'
    };
  }

  if (/機構$|事業団$|基金$/.test(name) && corporateType === '399') {
    return {
      primaryCategory: 'public-interest',
      secondaryCategory: '特殊法人・機構'
    };
  }

  if (/大学$/.test(name)) {
    return {
      primaryCategory: 'public-interest',
      secondaryCategory: '大学'
    };
  }

  if (/組合$/.test(name)) {
    return {
      primaryCategory: 'public-interest',
      secondaryCategory: '組合'
    };
  }

  if (/協会$/.test(name) && corporateType === '399') {
    return {
      primaryCategory: 'public-interest',
      secondaryCategory: '協会'
    };
  }

  // その他・個人
  return {
    primaryCategory: 'individual-other',
    secondaryCategory: '個人・その他'
  };
}

/**
 * 業種タグの判定
 */
function detectIndustryTags(spending: SpendingRecord): IndustryTag[] {
  const name = spending.spendingName;
  const tags: IndustryTag[] = [];

  // 名前パターンから判定
  if (/システム|保守|運用|クラウド|ネットワーク/.test(name)) {
    tags.push('ITシステム・保守');
  }

  if (/防衛|装備|誘導弾|艦艇|航空機/.test(name)) {
    tags.push('防衛・装備');
  }

  if (/建設|土木|整備局|工事/.test(name)) {
    tags.push('建設・土木');
  }

  if (/コンサル|アクセンチュア|デロイト|PwC|McKinsey/.test(name)) {
    tags.push('コンサルティング');
  }

  if (/事務局|協議会|推進|支援事業/.test(name)) {
    tags.push('事務局・BPR');
  }

  if (/大学|研究|学術|科学/.test(name)) {
    tags.push('教育・研究');
  }

  if (/医療|保険|健康|病院/.test(name)) {
    tags.push('医療・保険');
  }

  if (/エネルギー|石油|ガス|電力/.test(name)) {
    tags.push('エネルギー');
  }

  if (/印刷|広告|博報堂|電通/.test(name)) {
    tags.push('印刷・広告');
  }

  if (/農業|農政|林業|森林|水産/.test(name)) {
    tags.push('農林水産');
  }

  // 事業名からも判定可能だが、まずは名前ベースで実装

  if (tags.length === 0) {
    tags.push('その他');
  }

  return tags;
}
```

---

## 5. 実装計画

### Phase 1: 基本タグ付けとデータ生成（優先度: 高）

**作業内容**:
1. `types/structured.ts` に `SpendingTags` 型を追加
2. `scripts/tag-classifier.ts` を作成（上記ロジック）
3. `scripts/generate-structured-json.ts` でタグ付けを実行
   ```typescript
   // SpendingRecordを生成する際にタグ付け
   const spending: SpendingRecord = {
     // ... 既存フィールド
     tags: classifySpending(spendingData)
   };
   ```
4. データ再生成: `npm run generate-structured`

**成果物**:
- `rs2024-structured.json` に全支出先のタグが含まれる

### Phase 2: UI表示（優先度: 高）

**作業内容**:
1. サンキー図のツールチップにタグ表示
   ```tsx
   // app/sankey/page.tsx
   nodeTooltip={({ node }) => (
     <div>
       <strong>{node.name}</strong>
       <div>{formatCurrency(node.value)}</div>
       {node.details?.tags && (
         <div className="flex gap-1 mt-2">
           <span className="badge">{node.details.tags.secondaryCategory}</span>
           {node.details.tags.industryTags.map(tag => (
             <span key={tag} className="badge-sm">{tag}</span>
           ))}
         </div>
       )}
     </div>
   )}
   ```

2. 支出先詳細ダイアログにタグセクション追加
3. 再委託先詳細ダイアログにタグ表示

**成果物**:
- ユーザーが支出先の組織種別・業種を一目で把握可能

### Phase 3: フィルタリング機能（優先度: 中）

**作業内容**:
1. TopN設定パネルにタグフィルタを追加
   ```tsx
   // client/components/TopNSettingsPanel.tsx
   <div>
     <label>組織種別で絞り込み</label>
     <select value={primaryCategoryFilter} onChange={...}>
       <option value="">すべて</option>
       <option value="government">行政組織</option>
       <option value="private">民間企業</option>
       <option value="public-interest">公益法人等</option>
     </select>
   </div>
   ```

2. サンキー生成時にフィルタ適用

**成果物**:
- 「民間企業のみ表示」「公益法人のみ表示」などの絞り込みが可能

### Phase 4: ベンダーロックインリスク評価の自動化（優先度: 中）

**作業内容**:
1. 占有率・入札者数・落札率の自動計算
2. リスクレベルの自動判定
3. レポート生成の自動化

**成果物**:
- 調査フローに基づく自動リスク評価
- タグ付きデータを使った定期レポート生成

---

## 6. データサンプル

### 6.1 タグ付き支出先レコード例

```json
{
  "spendingId": 123,
  "spendingName": "株式会社博報堂",
  "corporateNumber": "1234567890123",
  "corporateType": "",
  "totalSpendingAmount": 2468930000000,
  "projectCount": 5,
  "tags": {
    "primaryCategory": "private",
    "secondaryCategory": "株式会社",
    "industryTags": ["事務局・BPR", "印刷・広告"],
    "lockInRisk": "critical",
    "lockInRiskReason": "電気・ガス価格激変緩和対策事業で占有率72.2%、4系再委託構造"
  }
}
```

```json
{
  "spendingId": 456,
  "spendingName": "関東地方整備局",
  "corporateType": "301",
  "totalSpendingAmount": 524690000000,
  "projectCount": 41,
  "tags": {
    "primaryCategory": "government",
    "secondaryCategory": "地方整備局等",
    "industryTags": ["建設・土木"],
    "lockInRisk": "monitor"
  }
}
```

```json
{
  "spendingId": 789,
  "spendingName": "国立研究開発法人宇宙航空研究開発機構",
  "corporateType": "399",
  "totalSpendingAmount": 593440000000,
  "projectCount": 16,
  "tags": {
    "primaryCategory": "public-interest",
    "secondaryCategory": "国立研究開発法人",
    "industryTags": ["教育・研究"],
    "lockInRisk": "strategic",
    "lockInRiskReason": "国家プロジェクトとして正当な独占"
  }
}
```

---

## 7. 期待される効果

### 7.1 データ可視化の改善

- **Before**: 支出先名のみで判断、「株式会社博報堂」が民間企業か行政組織か一見不明
- **After**: タグバッジで「株式会社」「事務局・BPR」と即座に分かる

### 7.2 分析の効率化

- **Before**: 「民間企業への支出総額」を集計するには手動で企業名を抽出
- **After**: `primaryCategory === 'private'` でフィルタして即座に集計可能

### 7.3 ベンダーロックイン調査の自動化

- **Before**: 手作業で占有率計算、リスク評価、レポート作成（数時間）
- **After**: タグベースで自動評価、レポート生成スクリプト実行（数分）

---

## 8. 今後の拡張可能性

1. **企業グループタグ**: 「富士通グループ」「三菱グループ」などの企業系列タグ
2. **地域タグ**: 本社所在地による地域別分析（関東、関西など）
3. **資本関係タグ**: 親会社・子会社関係の可視化
4. **再委託パターンタグ**: 「常に再委託する企業」などのフラグ

---

## 9. 実装の優先順位まとめ

| Phase | 内容 | 優先度 | 工数目安 |
|:------|:-----|:-------|:---------|
| Phase 1 | 基本タグ付けとデータ生成 | 高 | 4時間 |
| Phase 2 | UI表示（ツールチップ、ダイアログ） | 高 | 3時間 |
| Phase 3 | フィルタリング機能 | 中 | 5時間 |
| Phase 4 | リスク評価自動化 | 中 | 8時間 |

**推奨**: Phase 1 → Phase 2 を優先実装し、すぐに可視化の改善効果を確認する。

---

**作成者**: Claude Sonnet 4.5
**次のステップ**: Phase 1の実装開始
